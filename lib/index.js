"use strict";var O=Object.create;var g=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var $=Object.getPrototypeOf,S=Object.prototype.hasOwnProperty;var V=(r,e,t)=>e in r?g(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var H=(r,e)=>{for(var t in e)g(r,t,{get:e[t],enumerable:!0})},E=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of z(e))!S.call(r,i)&&i!==t&&g(r,i,{get:()=>e[i],enumerable:!(n=P(e,i))||n.enumerable});return r};var u=(r,e,t)=>(t=r!=null?O($(r)):{},E(e||!r||!r.__esModule?g(t,"default",{value:r,enumerable:!0}):t,r)),j=r=>E(g({},"__esModule",{value:!0}),r);var c=(r,e,t)=>(V(r,typeof e!="symbol"?e+"":e,t),t);var I={};H(I,{createEnvSchema:()=>x,default:()=>K,getInstance:()=>w});module.exports=j(I);var d=u(require("fs")),p=u(require("path"));var h=u(require("winston")),Z={info:"\x1B[32m",warn:"\x1B[33m",error:"\x1B[31m"},N=h.default.format.combine(h.default.format.timestamp({format:"YYYY-MM-DD HH:mm:ss"}),h.default.format.printf(({level:r,message:e,timestamp:t})=>{let n=Z[r]||"\x1B[0m";return`${t} ${n}${r}\x1B[0m: ${n}${e}\x1B[0m`})),k=new h.default.transports.Console,M=new h.default.transports.File({filename:"logfile.log"}),b=h.default.createLogger({format:N,transports:[k,M]});function m(r,e){e&&b.info(r)}var T=b;var y=require("zod");var f=class r{constructor(e,t){c(this,"schema");c(this,"rootPath");c(this,"envs");c(this,"logs");c(this,"throwErrorOnValidationFail");c(this,"envFileHierarchy");this.rootPath=p.default.resolve(process.cwd(),t?.rootPath||""),this.logs=t?.logs??!0,this.throwErrorOnValidationFail=t?.throwErrorOnValidationFail??!0,this.envFileHierarchy=t?.envFileHierarchy||[".env"],this.envs=this.collectEnvs(),this.schema=e(y.z)}static getInstance(e){let t=e?.envFileHierarchy||[".env"],n=e?.logs??!0,i=!1,a=p.default.resolve(process.cwd(),e?.rootPath||""),l=new r(()=>y.z.object({}),{logs:n,rootPath:a,throwErrorOnValidationFail:i,envFileHierarchy:t});return l.envs=l.collectEnvs(),l}static createEnvSchema(e,t){let n=t?.envFileHierarchy||[".env"],i=t?.logs??!0,a=t?.throwErrorOnValidationFail??!0,l=p.default.resolve(process.cwd(),t?.rootPath||""),s=new r(e,{logs:i,rootPath:l,throwErrorOnValidationFail:a,envFileHierarchy:n});s.envs=s.collectEnvs();try{s.schema.parse(s.envs)}catch(v){if(s.throwErrorOnValidationFail)throw v;T.error(v)}return s}get(e,t){this.envs||(this.envs=this.collectEnvs());let n=this.envs[e];if(n===void 0){let a=this.schema.shape[e]?._def.defaultValue?.()??void 0;return t??a}let i=this.schema.shape[e];return i?i.parse(n):n}getAll(){return this.envs||(this.envs=this.collectEnvs()),this.envs}collectEnvs(){let e=this.envFileHierarchy;if(typeof e=="string"){let t=`${this.rootPath}/${e}`;if(!d.default.existsSync(t)&&!this.throwErrorOnValidationFail)return m(`Environment file not found: ${t}`,this.logs),{};if(!d.default.existsSync(t))throw new Error(`Environment file not found: ${t}`);return this.parseEnvFile(t)}for(let t of e){let n=`${this.rootPath}/${t}`;if(!d.default.existsSync(n)){m(`Environment file not found: ${n}`,this.logs),m("Trying next environment file...",this.logs);continue}return this.parseEnvFile(n)}if(this.throwErrorOnValidationFail)throw new Error("Environment file not found");return m("No environment file in the hierarchy list found",this.logs),{}}parseEnvFile(e){let n=d.default.readFileSync(e,"utf8").split(`
`),i={},a=/^(\S+)\s*=\s*(?:"([^"]*)"|'([^']*)'|(\[.*\]|\{.*\}|\S+))/;for(let l of n){let s=l.match(a);if(!s)continue;let v=s[1],o=s[2]||s[3]||s[4];if(!(o&&o.trim().startsWith("#"))){if(o===void 0&&(o=""),o.startsWith("[")&&o.endsWith("]")&&(o=o.slice(1,-1).split(",").map(F=>F.trim().replace(/^["']|["']$/g,""))),typeof o=="string"&&o.startsWith("{")&&o.endsWith("}"))try{o=JSON.parse(o)}catch{console.error(`Failed to parse JSON in the environment file for key ${v}: ${o}`)}(o==="true"||o==="false")&&(o=!!o),i[v]=o}}return i}};var w=f.getInstance,x=f.createEnvSchema,K={getInstance:w,createEnvSchema:x};0&&(module.exports={createEnvSchema,getInstance});
//# sourceMappingURL=index.js.map